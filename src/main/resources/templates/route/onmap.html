<!DOCTYPE html>
 <html xmlns:th="http://www.thymeleaf.org">
 	<head lang="en" th:replace="fragments/head :: head"> </head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 	<style>
        #map {
        float: left;
         height: 400px;
         width: 50%;
        }
     </style>
 <body>
 
<div lang="en" th:replace="fragments/header :: header"> </div>

	
 <div class="row">
 <div class="col-sm-6">
 <div class="container">

	
 <div th:if="${#lists.isEmpty(deliveries)}">
		<h1> you finished your route</h1></div>
 <div th:if="${not #lists.isEmpty(deliveries)}">
 
 <h1>the next delivery on the map</h1>
 
 
 <div id="map"></div>
 
 	<script text="text/javascript" th:inline="javascript">
 	/*<![CDATA[*/
 	var addresses = [[${addresses}]];
 	
 	
 	// Sets up the map
 	function myMap() {
 		
 	var mapOptions = {
 	    center: new google.maps.LatLng(46.94809, 7.44744),
 	    zoom: 8,
 	    mapTypeId: google.maps.MapTypeId.HYBRID
 	}
 	var geocoder = new google.maps.Geocoder();
 	
 	var bern = {lat: 46.94809, lng: 7.44744};
 	
 	var map = new google.maps.Map(document.getElementById("map"), mapOptions);
 	
 	addMarker(bern, map, 'Firm');
 	
 	codeCenter(geocoder, map, addresses[0]);
 	
 	for(i = 1; i< addresses.length;i++)
 		{codeAddress(geocoder, map, addresses[i]);}
 	
 	
 	}
 	/*]]>*/
 	// Codes the DeliveryAddress
 	function codeAddress(geocoder, thismap, deliveryaddress) {
     var address2 = deliveryaddress;
     geocoder.geocode( { 'address': address2}, function(results, status) {
       if (status == 'OK') {
         addMarker(results[0].geometry.location, thismap, address2);
       } else {
         alert('Geocode was not successful for the following reason: ' + status + address2);
       }
     });
   }
 	
 	// Codes the DeliveryAddres at the next delivery
 	function codeCenter(geocoder, thismap, deliveryaddress) {
     var address2 = deliveryaddress;
     geocoder.geocode( { 'address': address2}, function(results, status) {
       if (status == 'OK') {
         setCenter(results[0].geometry.location, thismap, address2);
       } else {
         alert('Geocode was not successful for the following reason: ' + status + address2);
       }
     });
   }
 	// Adds a Marker to the map
 	function addMarker(position, displayedmap, address){
         var marker = new google.maps.Marker({
             map: displayedmap,
             position: position,
             title: address
         });
 	}
 	
 	// Sets the center of the map
 	function setCenter(position, displayedmap, address){
 		var marker = new google.maps.Marker({
            map: displayedmap,
            position: position,
            title: address
        });
 		displayedmap.panTo(marker.getPosition());
 	}
   </script>
 <script 
 async = "async"
 defer = "defer"
 src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAb-SCpWFMSIO0OeVAES-xWjRfLAIwzv7g&amp;callback=myMap"></script>
 
 </div>
 <div class="col-sm-6">
 
<div th:if="${not #lists.isEmpty(deliveries)}">
			  <table class="table table-hover">
		    	<thead>
			    	<tr>
			    		<th>address</th>
			    		<th>orderitems</th>
			    		<th></th>
			    	</tr>
			    </thead>
			    <tbody>
			    	<tr>
			    		<td th:text="${route.getCurrentAddress().toString()}"></td>
			    		<td>
			    			<ul th:each= "orderItem : ${route.getCurrentDelivery().getItems()}">
			    				<li th:text = "${orderItem.toString()}"></li>
			    			</ul>
			    		</td>
			    		<td></td>
					</tr>
				</tbody>
				</table> 
				
				<table>
    		<tr>
    			
    			<td>
	    			<form action="#" th:action="@{/route/acceptDelivery/{id}(id = ${route.getCurrentAddress().getId()})}" th:object="${route}" method="post"> 
			    	<input type="hidden" name="routeid" th:value="${route.getId()}"/>
			    	<button type="submit" class="btn btn-primary">accept delivery</button>
					</form>
                </td>
                <td>
                	<form action="#" th:action="@{/route/rejectDelivery/{id}(id = ${route.getCurrentAddress().getId()})}" th:object="${route}" method="post"> 
		    		<input type="hidden" name="routeid" th:value="${route.getId()}"/>
		    		<button type="submit" class="btn btn-primary">reject delivery</button>
					</form>
                </td>
    		</tr>
    		
    	</table>
		    
			
			</div>
</div>

<div th:if="${#lists.isEmpty(deliveries)}">
		<h3> no deliveries remaining </h3></div>

</div>
 </div>
 </div>
 </body>
 </html>